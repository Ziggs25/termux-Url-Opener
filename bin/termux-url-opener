#!/data/data/com.termux/files/usr/bin/bash

# Config

MUSIC="storage/music"
ASMR="storage/shared/.nsfw"
VIDEOS="storage/movies"
CLIPS="storage/movies/Clips"
DOWNLOADS="storage/downloads/navi/"

# End

url=$1

echo Download Youtube Video

method="$(termux-dialog sheet -v "Download ASMR,Download Music,Download Video,Clip,Aria,Cancel" | jq '.index' -r)"

finished () {
    termux-toast -s Your Download Is Done;
}

case $method in
  1)
    yt-dlp -f bestaudio[ext=m4a] $url -o "$MUSIC/%(title)s.%(ext)s" --embed-thumbnail --add-metadata
    finished
	  ;;
  0)
    yt-dlp -f bestaudio --extract-audio --embed-thumbnail --embed-metadata -o "$ASMR/yt/%(channel)s/%(upload_date)s-%(title)s-%(id)s.%(ext)s" --embed-thumbnail --embed-metadata $url
    finished
	  ;;
  2)
    yt-dlp $url -f 'bestvideo[ext=mp4]+bestaudio[ext=m4a]/mp4' -o "$VIDEOS/%(title)s-%(id)s.%(ext)s" --embed-subs --embed-thumbnail --embed-metadata
    finished
	  ;;
  3)
    start="$(termux-dialog text -i "start (HH:MM:SS)" | jq '.text' -r)"
    end="$(termux-dialog text -i "end (HH:MM:SS)" | jq '.text' -r)"
    title="$(termux-dialog text -i "clip title" | jq '.text' -r)"
    ffmpeg -ss $start -to $end -i "$(yt-dlp -f best --get-url $url)" -c:v copy -c:a copy $CLIPS/$title.mp4
    finished
    ;;
  4)
    aria2c $url -d $DOWNLOADS
    termux-notification -c "$1 Download done" --icon file_download
    ;;
  5)
    echo "Bye"
    ;;

esac
